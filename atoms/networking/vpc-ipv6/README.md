# Challenge: Create a single VPC with IPv4 and IPv6 CIDIR blocks

## Table of content
* [Problem description](#problem-description)
* [Solutions](#solutions)
* [What we learnt](#what-we-learnt)

## Problem description

Create a VPC with IPv4 and IPv6 CIDIR blocks, abided by following [Common context](../../../README.md#common-context):
  * Single account compliance.
  * Resource tagging compliance.
  * AWS Region compliance.

The solution must be generic enough to be reused by whatever department.

**Input:**
  * `VPCName`<br>
    Last part of VPC instance. The full name must be built with this format
    `{costCenter}-{environmentType}-{VPCName`}. For example: fin-nonprod-services-v1, sec-prod-tooling-v123...

    *Required*: Yes

    *Type*: String

  * `NetworkAddressIpV4`<br>
    The IP address part of the IPv4 CIDR block, before slash (/). E.g: 10.0.0.0

    *Required*: Yes

    *Type*: String

  * `CidrBlockSizeIpV4`<br>
    The bits part of the IPv4 CIDR block, after slash (/). E.g: 8, 16, 24<br>
    Valid values are from `8` to `30`.

    *Required*: Yes

    *Type*: Number

  * `CostCenter`<br>
    The department code.

    *Required*: Yes

    *Type*: String

  * `EnvironmentType`<br>
    The deployment environment type.

    *Required*: Yes

    *Type*: String

**Output:**
  * `VpcId`<br>
    ID of the created VPC. It must be exported for region-wide reuse.

    *Type*: String

  * `NetworkAddressIpV4`<br>
    Value of the parameter `NetworkAddressIpV4` but exported for region-wide reuse.

    *Type*: String

  * `CidrBlockSizeIpV4`<br>
    Value of the parameter `CidrBlockSizeIpV4` but exported for region-wide reuse.

    *Type*: String

  * `NetworkAddressIpV6`<br>
    The IP address part of the IPv6 CIDR block, before slash (/). E.g: `2001:db8:1234:1a00::`, `2406:da18:f21:d900:0:0:0:0`. It must be
    exported for region-wide reuse.

    *Type*: String

  * `CidrBlockSizeIpV6`<br>
    The bits part of the IPv6 CIDR block, after slash (/). The value is fixed at `56`. It must be
    exported for region-wide reuse.

    *Type*: String

## Solutions

**NOTICE** The solution creates a VPC, you won't be billed for the created resource if you execute the code.

### **Cloudformation**

You can start with this template and modify it to satisfy this challenge: https://github.com/awslabs/aws-cloudformation-templates/blob/master/aws/services/VPC/VPC_With_Managed_NAT_And_Private_Subnet.yaml

To run this solution:
  - `cd` to this directory
  - `./run-cfm.sh create` or `./run-cfm.sh` for help menu

## What we learnt

* [The IPv6 CIDR block size is fixed at /56](https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ec2-vpccidrblock.html#:~:text=The%20IPv6%20CIDR%20block%20size%20is%20fixed%20at%20/56),
and the IPv6 CIDR block is generated by AWS, we cannot specify it.

* Cloudformation exported values can be reused by other Cloudformation templates in same Account and Region.

* Since this is a basic challenge without using AWS Organization Service Control Policy to enforce
the AWS Region compliance, we take advantage of `Conditions` block to do validation. The create CLI
will fail with error "Template error: Unable to get mapping" if we configure AWS CLI to run with
disallowed Regions.
